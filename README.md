# WebDAV åˆ†æ®µå¹¶è¡Œå¤‡ä»½è„šæœ¬ (WebDAV Segmented Parallel Backup Script)

[![Language](https://img.shields.io/badge/Language-Bash-blue.svg)](https://www.gnu.org/software/bash/)

ä¸€ä¸ªå¼ºå¤§ä¸”è‡ªåŠ¨åŒ–çš„ Bash è„šæœ¬ï¼Œç”¨äºå°†å¤§å‹ç›®å½•å¤‡ä»½åˆ°æ”¯æŒ WebDAV åè®®çš„äº‘å­˜å‚¨æœåŠ¡ï¼ˆå¦‚ 123äº‘ç›˜ã€åšæœäº‘ã€Nextcloud ç­‰ï¼‰ã€‚

è¯¥è„šæœ¬ç‰¹åˆ«é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š
*   éœ€è¦å¤‡ä»½çš„æ•°æ®é‡å·¨å¤§ï¼ˆä¾‹å¦‚ Minecraft æœåŠ¡å™¨å­˜æ¡£ã€ç½‘ç«™æ–‡ä»¶ç­‰ï¼‰ã€‚
*   ç›®æ ‡äº‘å­˜å‚¨å¯¹å•ä¸ªä¸Šä¼ æ–‡ä»¶æœ‰å¤§å°é™åˆ¶ã€‚
*   æœåŠ¡å™¨å‡ºå£å¸¦å®½æœ‰é™ï¼Œå¸Œæœ›é€šè¿‡å¹¶è¡Œä¸Šä¼ æ¥æœ€å¤§åŒ–åˆ©ç”¨å¸¦å®½ï¼Œç¼©çŸ­å¤‡ä»½æ—¶é—´ã€‚

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§ (Features)

*   **ğŸ—œï¸ åˆ†æ®µå‹ç¼©ä¸ä¸Šä¼ :** è‡ªåŠ¨å°†æºç›®å½•æ‰“åŒ…å‹ç¼©ï¼Œå¹¶åˆ†å‰²æˆæŒ‡å®šå¤§å°çš„æ®µæ–‡ä»¶ï¼Œçªç ´å•æ–‡ä»¶ä¸Šä¼ é™åˆ¶ã€‚
*   **ğŸš€ å¹¶è¡Œä¸Šä¼ :** åŒæ—¶ä¸Šä¼ å¤šä¸ªåˆ†æ®µæ–‡ä»¶ï¼Œæ˜¾è‘—å‡å°‘æ€»å¤‡ä»½è€—æ—¶ï¼Œå……åˆ†åˆ©ç”¨æœåŠ¡å™¨å¸¦å®½ã€‚
*   **ğŸ§¹ è‡ªåŠ¨ä¿ç•™ç­–ç•¥:** è‡ªåŠ¨æ¸…ç†äº‘ç«¯çš„æ—§å¤‡ä»½ï¼Œä»…ä¿ç•™æœ€è¿‘çš„ N ä»½å¤‡ä»½ï¼Œæœ‰æ•ˆç®¡ç†å­˜å‚¨ç©ºé—´ã€‚
*   **ğŸ›¡ï¸ å®‰å…¨ä¼˜å…ˆ:** é€šè¿‡ç¯å¢ƒå˜é‡è¯»å– WebDAV ç”¨æˆ·åå’Œå¯†ç ï¼Œé¿å…åœ¨è„šæœ¬ä¸­ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯ã€‚
*   **ğŸ“„ è¯¦ç»†æ—¥å¿—:** è®°å½•æ¯ä¸ªå…³é”®æ­¥éª¤ï¼ŒåŒ…æ‹¬å‹ç¼©ã€ä¸Šä¼ ï¼ˆå«è¿›ç¨‹IDï¼‰ã€æ¸…ç†ç­‰ï¼Œæ–¹ä¾¿è¿½è¸ªå’Œæ’é”™ã€‚
*   **ğŸ’ª å¥å£®å¯é :** åŒ…å«å®Œæ•´çš„ä¾èµ–æ£€æŸ¥ã€é…ç½®éªŒè¯å’Œé”™è¯¯å¤„ç†æœºåˆ¶ï¼Œç¡®ä¿ä»»åŠ¡ç¨³å®šè¿è¡Œã€‚

---

## ğŸ”§ ç¯å¢ƒè¦æ±‚ (Requirements)

ç¡®ä¿æ‚¨çš„ Linux ç³»ç»Ÿä¸Šå®‰è£…äº†ä»¥ä¸‹å‘½ä»¤è¡Œå·¥å…·ï¼š
*   `bash` (v4.0 æˆ–æ›´é«˜ç‰ˆæœ¬)
*   `curl`
*   `tar`
*   `split`
*   `basename`

---

## ğŸš€ å¦‚ä½•ä½¿ç”¨ (How to Use)

### 1. ä¸‹è½½è„šæœ¬

```bash
git clone https://github.com/lansepeach/WebDAV-Backup.git
cd your-repo-name
# æˆ–è€…ç›´æ¥ä¸‹è½½è„šæœ¬æ–‡ä»¶
# wget https://raw.githubusercontent.com/lansepeach/WebDAV-Backup/refs/heads/main/webdav-backup.sh
```

### 2. æ·»åŠ æ‰§è¡Œæƒé™

```bash
chmod +x webdav-backup.sh
```

### 3. é…ç½®è„šæœ¬

ç›´æ¥ç¼–è¾‘ `webdav-backup.sh` æ–‡ä»¶é¡¶éƒ¨çš„ **`--- Configuration Section ---`** åŒºåŸŸï¼š

| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹ |
| :--- | :--- | :--- |
| `SOURCE_DIR` | **ã€å¿…å¡«ã€‘** éœ€è¦å¤‡ä»½çš„æºç›®å½•çš„ç»å¯¹è·¯å¾„ã€‚ | `"/opt/mcsmanager/daemon/data/InstanceData/..."` |
| `TEMP_DIR` | **ã€å¿…å¡«ã€‘** ç”¨äºå­˜æ”¾ä¸´æ—¶åˆ†æ®µæ–‡ä»¶çš„ç›®å½•ã€‚è¯·ç¡®ä¿æœ‰è¶³å¤Ÿç©ºé—´ã€‚ | `"/tmp/webdav_backup_temp"` |
| `SEGMENT_SIZE` | æ¯ä¸ªåˆ†æ®µæ–‡ä»¶çš„å¤§å°ã€‚å»ºè®®ç•¥å°äºäº‘ç›˜é™åˆ¶ã€‚ | `"950M"` |
| `WEBDAV_URL` | **ã€å¿…å¡«ã€‘** ä½ çš„ WebDAV ç›®æ ‡ç›®å½•çš„å®Œæ•´ URLï¼Œ**å¿…é¡»ä»¥ `/` ç»“å°¾**ã€‚ | `"https://webdav.123pan.cn/webdav/my_backups/"` |
| `RETENTION_COUNT`| å¸Œæœ›åœ¨äº‘ç«¯ä¿ç•™çš„æœ€æ–°å¤‡ä»½æ•°é‡ã€‚ | `7` |
| `EXCLUDES` | å‹ç¼©æ—¶éœ€è¦æ’é™¤çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œç”¨ç©ºæ ¼åˆ†éš”ã€‚ | `"--exclude='./cache' --exclude='./logs'"` |
| `MAX_PARALLEL_UPLOADS` | åŒæ—¶ä¸Šä¼ çš„æœ€å¤§ä»»åŠ¡æ•°ã€‚ | `4` |

### 4. è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆé‡è¦ï¼ï¼‰

ä¸ºäº†å®‰å…¨ï¼Œè„šæœ¬ä»ç¯å¢ƒå˜é‡ä¸­è¯»å– WebDAV å‡­æ®ã€‚**è¯·ä¸è¦å°†ç”¨æˆ·åå’Œå¯†ç ç›´æ¥å†™å…¥è„šæœ¬ã€‚**

**ä¸´æ—¶è®¾ç½® (ä»…å¯¹å½“å‰ç»ˆç«¯ä¼šè¯æœ‰æ•ˆ):**
```bash
export WEBDAV_USER="ä½ çš„WebDAVç”¨æˆ·å"
export WEBDAV_PASS="ä½ çš„WebDAVå¯†ç "
```

**æ°¸ä¹…è®¾ç½® (æ¨èç”¨äºè‡ªåŠ¨åŒ–ä»»åŠ¡):**
å°†ä¸Šè¿° `export` å‘½ä»¤æ·»åŠ åˆ°æ‚¨ç³»ç»Ÿçš„ `~/.bashrc`, `~/.profile` æˆ– `/etc/profile` æ–‡ä»¶æœ«å°¾ï¼Œç„¶åæ‰§è¡Œ `source ~/.bashrc` ä½¿å…¶ç”Ÿæ•ˆã€‚

### 5. æ‰§è¡Œè„šæœ¬

**æ‰‹åŠ¨æ‰§è¡Œ:**
```bash
# ç¡®ä¿å·²è®¾ç½®ç¯å¢ƒå˜é‡
./webdav-backup.sh
```

**é€šè¿‡ Cron æˆ– MCSManager è‡ªåŠ¨åŒ–æ‰§è¡Œ:**
åœ¨ MCSManager çš„è®¡åˆ’ä»»åŠ¡ä¸­ï¼Œæ‰§è¡Œå‘½ä»¤åº”è®¾ç½®ä¸ºï¼š
```bash
/bin/bash /path/to/your/webdav-backup.sh
```
**é‡è¦:** Cron æˆ– MCSManager ç­‰è‡ªåŠ¨åŒ–å·¥å…·é»˜è®¤å¯èƒ½ä¸ä¼šåŠ è½½ç”¨æˆ·çš„ `.bashrc` æ–‡ä»¶ã€‚ä¸ºç¡®ä¿è„šæœ¬èƒ½è¯»å–åˆ°ç¯å¢ƒå˜é‡ï¼Œæœ€ä½³å®è·µæ˜¯åˆ›å»ºä¸€ä¸ªå¯åŠ¨è„šæœ¬ï¼Œæˆ–è€…åœ¨ä»»åŠ¡å‘½ä»¤ä¸­ç›´æ¥å®šä¹‰å®ƒä»¬ï¼š
```bash
WEBDAV_USER="ä½ çš„ç”¨æˆ·å" WEBDAV_PASS="ä½ çš„å¯†ç " /bin/bash /path/to/webdav-backup-manager.sh
```

---

## ğŸ“¦ å¦‚ä½•æ¢å¤å¤‡ä»½ (How to Restore)

1.  ä»æ‚¨çš„ WebDAV æœåŠ¡å™¨ä¸‹è½½å±äºåŒä¸€æ¬¡å¤‡ä»½çš„æ‰€æœ‰åˆ†æ®µæ–‡ä»¶ (ä¾‹å¦‚ `...part_aa`, `...part_ab`, `...part_ac` ç­‰) åˆ°åŒä¸€ä¸ªç›®å½•ä¸‹ã€‚

2.  ä½¿ç”¨ `cat` å‘½ä»¤å°†æ‰€æœ‰åˆ†æ®µæ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªå®Œæ•´çš„å‹ç¼©åŒ…ï¼š
    ```bash
    cat mcsmanager_backup_YYYYMMDDHHMMSS.tar.gz.part_* > mcsmanager_backup_complete.tar.gz
    ```

3.  è§£å‹æ¢å¤æ–‡ä»¶ï¼š
    ```bash
    tar -xzf mcsmanager_backup_complete.tar.gz
    ```

---

## ğŸ“„ è®¸å¯è¯ (License)

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT License](LICENSE) æˆæƒã€‚
